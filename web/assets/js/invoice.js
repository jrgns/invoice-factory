!function(){var a={};this.tmpl=function b(c,d){var e=/\W/.test(c)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+c.replace(/[\r\t\n]/g," ").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"):a[c]=a[c]||b(document.getElementById(c).innerHTML);return d?e(d):e},this.tmplClear=function(){a={}},this.money_format=function(a){var b=parseFloat(a).toFixed(2).toString().split(".");return b[0]=b[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),b.join(".")},this.date_format=function(a){var b=new Date(a),c=b.getDate();c=10>c?"0"+c:c;var d=b.getMonth()+1;d=10>d?"0"+d:d;var e=b.getFullYear();return e+"-"+d+"-"+c}}();var Base,Invoice,InvoiceFactory,InvoiceLine,__slice=[].slice,__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},__indexOf=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};Base=function(){function a(){}return a.prototype.fireEvent=function(a,b){this.name=a,this.data=b},a.prototype.readable=function(){var a,b;return a=1<=arguments.length?__slice.call(arguments,0):[],b=this.__proto__?this.__proto__:this,a.forEach(function(a){var c;if(!Object.getOwnPropertyDescriptor(b,a))return c=""+a[0].toUpperCase()+a.slice(1),Object.defineProperty(b,a,{get:function(){return"get"+c in this?this["get"+c]():this["_"+a]}})})},a.prototype.accessor=function(){var a,b;return a=1<=arguments.length?__slice.call(arguments,0):[],b=this.__proto__?this.__proto__:this,a.forEach(function(a){var c;if(!Object.getOwnPropertyDescriptor(b,a))return c=""+a[0].toUpperCase()+a.slice(1),Object.defineProperty(b,a,{get:function(){return"get"+c in this?this["get"+c]():this["_"+a]},set:function(b){return"set"+c in this?this["set"+c](b):this["_"+a]=b,this.fireEvent(a,b)}})})},a}(),Invoice=function(a){function b(a,b){var c,d,e,f,g,h,i,j,k;this.element=b,this.accessor("to","from","contact","description","date","dueDate","lines","currentLine"),this.readable("currency","taxation","total","tax"),null==a&&(a={}),this._currency=null!=(c=a.currency)?c:"$",this._taxation={rate:null!=(d=a.taxRate)?d:null,name:null!=(e=a.taxName)?e:"Tax"},this._to=null!=(f=a.to)?f:"Client",this._from=null!=(g=a.from)?g:"HackerPlanet",this._contact=null!=(h=a.contact)?h:"info@hackerpla.net",this._description=null!=(i=a.description)?i:"Client Side Invoicing",this._date=null!=(j=a.date)?j:new Date,this._dueDate=null!=(k=a.dueDate)?k:new Date(this._date+7),this._total=0,this._lines=[]}return __extends(b,a),b.prototype.fireEvent=function(a,b){var c,d,e;return this.element.trigger("invoice-change",this),this.element.trigger("invoice-"+a,b),d=jQuery.parseHTML(jQuery("#invoiceTemplate").html()),d=jQuery(d).find('[data-show="invoice-'+a+'"]').text(),d&&(c=""+a[0].toUpperCase()+a.slice(1),"render"+c in this?b=this["render"+c](b):(e={},e[a]=b,b=tmpl(d,e))),jQuery('[data-show="invoice-'+a+'"]').html(b)},b.prototype.render=function(){return this.element.html(tmpl("invoiceTemplate",this))},b.prototype.renderForm=function(){var a;return this.currentLine=new InvoiceLine(this),a=tmpl("invoiceLineFormTemplate",this.currentLine),this.element.find('[data-show="invoice-lines"]').append(a)},b.prototype.renderLines=function(a){return null==a&&(a=this.lines),jQuery("#invoice-lines").html(""),a.reduce(function(a,b){return a+=tmpl("invoiceLineTemplate",b)},"")},b.prototype.getTax=function(){return this._tax=this._total*this._taxation.rate},b.prototype.getTotal=function(a){var b;return null==a&&(a=!0),this._total=null!=(b=this.lines)?b.reduce(function(a,b){return a+b.amount},0):void 0,null==this._total&&(this._total=0),a?this._total+this.getTax():this._total},b.prototype.setLines=function(a){var b,c,d,e,f;for(this._lines=[],e=null!=a?a:[],f=[],c=0,d=e.length;d>c;c++)b=e[c],f.push(this.addLine(b));return f},b.prototype.addLine=function(a){return __indexOf.call(this._lines,a)<0&&this._lines.push(a),this.fireEvent("lines",this.lines),this.fireEvent("total",this.total),this.fireEvent("tax",this.tax),this},b.prototype.getLine=function(a){var b;return b=null,this.lines.forEach(function(c){return c.number===a?b=c:void 0}),b},b.prototype.fromJSON=function(a){var b,c,d,e,f;d=JSON.parse(a);for(b in d)switch(c=d[b],b=b.replace(/^_/,"")){case"element":break;case"lines":break;case"currentLine":break;case"taxation":c={rate:null!=(e=c.taxRate)?e:null,name:null!=(f=c.taxName)?f:"Tax"},console.log(c),this[b]=c;break;case"tax":case"total":this[b]=parseInt(c);break;case"date":case"dueDate":this[b]=new Date(c);break;default:console.log(b+"::"+c),this[b]=c}return this},b}(Base),InvoiceFactory=function(a){function b(){this.accessor("templatePath")}return __extends(b,a),b.prototype.init=function(a){var b,c;return this.settings=a,null==this.settings&&(this.settings={}),this.settings.element=jQuery(null!=(b=this.settings.element)?b:"#online-invoice"),this.setTemplatePath(null!=(c=this.settings.templatePath)?c:"./assets/templates/invoice.js.html"),this.registerEvents(),this},b.prototype.generate=function(a){var b;return null==a&&(a={}),b=new Invoice(a,this.settings.element),b.render(),b.renderForm(),b},b.prototype.registerEvents=function(){return this.settings.element.on("click","#confirm-line",jQuery.proxy(this.confirmLine,this)),this.settings.element.on("change","input",jQuery.proxy(this.formChange,this)),this.settings.element.on("click",".edit-line",jQuery.proxy(this.editLine,this))},b.prototype.setTemplatePath=function(a){return this._templatePath=a,jQuery("#invoiceTemplate").remove(),jQuery("#invoiceLineTemplate").remove(),jQuery("#invoiceLineFormTemplate").remove(),jQuery.ajax({url:a,success:function(a){return jQuery("body").append(a)},dataType:"html",async:!1})},b.prototype.editLine=function(a){var b,c,d;return a.preventDefault(),c=jQuery(a.target).closest("tr"),d=c.data("number"),invoice.currentLine=invoice.getLine(d),jQuery("#line-form").remove(),b=tmpl("invoiceLineFormTemplate",invoice.currentLine),c.replaceWith(b)},b.prototype.confirmLine=function(a){return a.preventDefault(),this.formChange(),invoice.currentLine.description.length>0?(invoice.addLine(invoice.currentLine),invoice.renderForm()):(jQuery("#description").closest("td").addClass("has-error"),jQuery("#description").attr("placeholder","Please enter a description"))},b.prototype.formChange=function(){return invoice.currentLine.description=jQuery("#description").val(),invoice.currentLine.quantity=parseFloat(jQuery("#quantity").val()),invoice.currentLine.linePrice=parseFloat(jQuery("#linePrice").val()),jQuery("#amount").val(money_format(invoice.currentLine.amount))},b}(Base),window.invoiceFactory=new InvoiceFactory,InvoiceLine=function(a){function b(a,b,c,d,e){this.accessor("invoice","description","quantity","linePrice"),this.readable("amount","number","currency"),this._invoice=a,this._quantity=null!=c?c:1,this._linePrice=null!=d?d:0,this._description=null!=b?b:"",this._currency=null!=e?e:a.currency,this._number=a.lines.length+1}return __extends(b,a),b.prototype.getAmount=function(){return this._quantity*this._linePrice},b}(Base);